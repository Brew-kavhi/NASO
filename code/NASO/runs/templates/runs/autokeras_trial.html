{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load get_values %}


{% block content %}
<div class="container">
    <div class="card">
        <div class="card-body">
            <div class="d-flex flex-wrap">
                {% for item in hp %}
                <div class="col-4">
                    <strong>{{item}}</strong>: {% get_attribute_tag hp item %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <br>
    {% crispy form %}
</div>
{% block javascript %}

{{block.super}}
<script>
    $(document).ready(function() {
        {% if metric_configs %}
        // load the metric values
                let existing_metrics = {{metric_configs | safe}};
                for (const metric of existing_metrics) {
                    for(const argument of metric['arguments']) {
                        let fields = document.getElementsByName('metric_argument_' + metric['id'] + "_" + argument.name);
                        if (fields[0]) {
                            fields[0].value = argument.value;
                        }
                    }
                }
                delete existing_metrics;
            {% endif %}
            {% if callbacks_configs %}
                // load the callback values
                let existing_callbacks = {{callbacks_configs | safe}};
                for (const callback of existing_callbacks) {
                    for(const argument of callback['arguments']) {
                        let fields = document.getElementsByName('callback_argument_' + callback['id'] + "_" + argument.name);
                        if (fields[0]) {
                            fields[0].value = argument.value;
                        }
                    }
                }
                delete existing_callbacks;
                {% endif %}
                handleMetricChange($('#{{form.metrics.auto_id}}'));
                handleCallbackChange($('#{{form.callbacks.auto_id}}'));
               

        }
        );
    const False = false;
    const True = true;
    const None = undefined;
    var metricOptions = [
        {% for metric in form.metrics.field.queryset %}
    {
        "id": {{ metric.id }},
        "name": "{{ metric.name }}",
            "jsonConfig": {{ metric.required_arguments|safe }},
    },
    {% endfor %}
    ];
    var callbackOptions = [
        {% for callback in form.callbacks.field.queryset %}
    {
        "id": {{ callback.id }},
        "name": "{{ callback.name }}",
            "jsonConfig": {{ callback.required_arguments|safe|default:"{}" }},
            "metrics": {{ callback.registers_metrics|safe|default:"[]"}}
    },
    {% endfor %}
    ];

</script>
{% endblock javascript %}
{% endblock %}